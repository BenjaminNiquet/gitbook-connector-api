## Device integrations

In order to communicate with devices on the local hotel network, such as printers, lock systems, PBX, TVs, key cutters or fiscal machines, Mews has introduced the concept of devices and device commands. When a relevant action happens in Mews, a device command is generated and put into the device command queue. Using the API, you can pull the commands from the queue, process them as you find necessary and later mark them as processed. Of course, as many of the actions with devices should happen in real time, you should in most of the cases use this in combination with [Websockets](../websockets.md) to avoid polling for new commands. Whenever a relevant command is created, you would receive a notification about such an event through the opened websocket.

### Processing commands

First of all, you should subscribe your application for receiving device command events by connecting to the [Websockets](../websockets.md) endpoint. Since then, your application will receive all the newly created device commands in real time. You might also need to obtain all of the commands that are already pending in the queue while your application was offline. To do so, you should use the [Get all commands](../operations/integrations.md#get-all-commands) operation. You want to pull the pending commands every time your application reconnects using websockets, no matter how long it was offline. Otherwise, there might be some unprocessed commands in your queue.

Once you are notified via a websocket about the fact that a device command was created or updated, you need to pull the command into your application using [Get all commands](../operations/integrations.md#get-all-commands). Once done, you should mark the command as processed using the [Update command](../operations/integrations.md#update-command) operation.

#### Fiscal machine commands

In case your device is a Fiscal Machine \(no matter whether it is a virtual or a physical one\), you would get a command containing [Fiscal machine command data](../operations/integrations.md#fiscal-machine-command-data). That involves all data of the related [Bill](../operations/finance.md#bill) including all the payments and revenue items in a form of [Accounting item](../operations/finance.md#accounting-item). Currently, there is no way how to send any fiscal code generated by the fiscal machine back to Mews.

#### Key cutter commands

In case your device is a Key Cutter, you would get a command containing [Key cutter command data](../operations/integrations.md#key-cutter-command-data).

### Testing your integration

Once your integration is completed, all endpoints should be tested prior to initiating the [certification process](https://intercom.help/mews-systems/en/articles/4497819-connector-api-certification-what-to-expect) with the Mews Marketplace team. Testing your solution is done directly in the Connector API demo. You should use the credentials found in the [Authentication](../guidelines.md#authentication) section to sign in as an end-user. This allows you to fully understand how both systems will be used by the property and gives you additional information to ensure you provide a seamless and efficient onboarding experience for our hoteliers.

To be able to use your device integration, an additional step of configuring the device and connecting it to the relevant API access token is required. This is done through the following steps:

1. Open the main menu in the top left corner, scroll down and click on **Marketplace**.
2. Depending on the type of device you are connecting, click on either Facility management (Key cutter integration, Passport scanner integration, Printer integration) or Legal environment (Fiscal machine integration) categories.
3. Once you've found the correct device integration, click **See more** followed by **Connect** to generate this device integration.
4. Complete the required fields for the relevant device and be sure to save the configuration.
5. Go back to your unique API access token found in the **My subscriptions** section of the Marketplace and click on the **Settings** found on the right side of the integration listing.
6. On the right side, you will see a drop down menu titled Connected devices. Select your newly created device from that list and click **Save**.

This is the same process that will be required when you assist any new mutual client with onboarding and configuration of your solution.

For a full overview of device commands and their states, you can check the [device commands queue](https://intercom.help/mews-systems/en/articles/4245952-device-commands-queue) in Mews. If you are returning an unexpected error indicating there is an issue with the Data JSON, please review [this article](https://intercom.help/mews-systems/en/articles/4394724-data-json-incorrect-or-unsupported-device) to understand what this indicates, based on the type of integration you are referring to.
